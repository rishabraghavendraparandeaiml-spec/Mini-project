<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alternative Location Methods</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 400px; border-radius: 8px; }
        .location-card { 
            cursor: pointer; 
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .location-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        .location-card.selected {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        .accuracy-badge {
            font-size: 0.75em;
            padding: 0.25em 0.5em;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üìç Alternative Location Methods</h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üó∫Ô∏è Location Map</h5>
                        <div>
                            <button class="btn btn-primary btn-sm" onclick="getCurrentGPSLocation()">
                                <i class="fas fa-satellite-dish"></i> Try GPS
                            </button>
                            <button class="btn btn-success btn-sm" onclick="useSelectedLocation()">
                                <i class="fas fa-check"></i> Use Selected
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="map"></div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">üìä Current Location Status</h6>
                    </div>
                    <div class="card-body">
                        <div id="locationStatus">
                            <div class="text-muted">No location selected</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">üéØ Alternative Location Methods</h6>
                    </div>
                    <div class="card-body">
                        <div id="locationMethods">
                            <!-- Location methods will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0">üèôÔ∏è Popular Test Locations</h6>
                    </div>
                    <div class="card-body">
                        <div id="testLocations">
                            <!-- Test locations will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map;
        let currentMarker = null;
        let selectedLocation = null;
        
        // Alternative location methods
        const locationMethods = [
            {
                id: 'gps',
                name: 'GPS Location',
                description: 'High accuracy GPS',
                icon: 'fas fa-satellite-dish',
                accuracy: '5-10m',
                method: getCurrentGPSLocation
            },
            {
                id: 'network',
                name: 'Network Location',
                description: 'WiFi/Cell tower based',
                icon: 'fas fa-wifi',
                accuracy: '20-100m',
                method: getNetworkLocation
            },
            {
                id: 'ip',
                name: 'IP Geolocation',
                description: 'Internet IP based',
                icon: 'fas fa-globe',
                accuracy: '1-10km',
                method: getIPLocation
            },
            {
                id: 'manual',
                name: 'Manual Selection',
                description: 'Click on map',
                icon: 'fas fa-mouse-pointer',
                accuracy: 'Exact',
                method: enableManualSelection
            }
        ];
        
        // Popular test locations
        const testLocations = [
            {
                name: 'Bangalore, India',
                lat: 12.9716,
                lng: 77.5946,
                description: 'Tech hub of India'
            },
            {
                name: 'Mumbai, India',
                lat: 19.0760,
                lng: 72.8777,
                description: 'Financial capital'
            },
            {
                name: 'Delhi, India',
                lat: 28.6139,
                lng: 77.2090,
                description: 'National capital'
            },
            {
                name: 'New York, USA',
                lat: 40.7128,
                lng: -74.0060,
                description: 'The Big Apple'
            },
            {
                name: 'London, UK',
                lat: 51.5074,
                lng: -0.1278,
                description: 'United Kingdom'
            },
            {
                name: 'Tokyo, Japan',
                lat: 35.6762,
                lng: 139.6503,
                description: 'Land of rising sun'
            }
        ];
        
        // Initialize the application
        function init() {
            initMap();
            loadLocationMethods();
            loadTestLocations();
            
            // Try to get user's actual location first
            setTimeout(getCurrentGPSLocation, 1000);
        }
        
        // Initialize Leaflet map
        function initMap() {
            map = L.map('map').setView([12.9716, 77.5946], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add click handler for manual location selection
            map.on('click', function(e) {
                setLocation(e.latlng.lat, e.latlng.lng, 'Manual Selection', 'exact');
            });
        }
        
        // Load location methods
        function loadLocationMethods() {
            const container = document.getElementById('locationMethods');
            
            locationMethods.forEach(method => {
                const card = document.createElement('div');
                card.className = 'location-card card mb-2';
                card.onclick = method.method;
                
                card.innerHTML = `
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center">
                            <i class="${method.icon} text-primary me-2"></i>
                            <div>
                                <strong>${method.name}</strong>
                                <div class="small text-muted">${method.description}</div>
                                <span class="accuracy-badge badge bg-info">${method.accuracy}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // Load test locations
        function loadTestLocations() {
            const container = document.getElementById('testLocations');
            
            testLocations.forEach(location => {
                const card = document.createElement('div');
                card.className = 'location-card card mb-2';
                card.onclick = () => setLocation(location.lat, location.lng, location.name, 'test location');
                
                card.innerHTML = `
                    <div class="card-body p-2">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-map-marker-alt text-success me-2"></i>
                            <div>
                                <strong class="small">${location.name}</strong>
                                <div class="small text-muted">${location.description}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // Set location on map and update status
        function setLocation(lat, lng, source, accuracy) {
            // Remove existing marker
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }
            
            // Add new marker
            currentMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'current-location-marker',
                    html: '<i class="fas fa-map-marker-alt" style="color: #dc3545; font-size: 20px;"></i>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 20]
                })
            }).addTo(map);
            
            // Center map on location
            map.setView([lat, lng], 15);
            
            // Store selected location
            selectedLocation = { lat, lng, source, accuracy };
            
            // Update status
            updateLocationStatus(lat, lng, source, accuracy);
            
            // Highlight selected method cards
            document.querySelectorAll('.location-card').forEach(card => {
                card.classList.remove('selected');
            });
        }
        
        // Update location status display
        function updateLocationStatus(lat, lng, source, accuracy) {
            const statusDiv = document.getElementById('locationStatus');
            
            statusDiv.innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <strong>Coordinates:</strong><br>
                        <code>${lat.toFixed(6)}, ${lng.toFixed(6)}</code>
                    </div>
                    <div class="col-6">
                        <strong>Source:</strong><br>
                        ${source}
                    </div>
                    <div class="col-6 mt-2">
                        <strong>Accuracy:</strong><br>
                        <span class="badge bg-info">${accuracy}</span>
                    </div>
                    <div class="col-6 mt-2">
                        <strong>Status:</strong><br>
                        <span class="badge bg-success">Active</span>
                    </div>
                </div>
            `;
        }
        
        // GPS Location Method
        function getCurrentGPSLocation() {
            if (!navigator.geolocation) {
                alert('GPS not supported by this browser');
                return;
            }
            
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = Math.round(position.coords.accuracy);
                    
                    setLocation(lat, lng, 'GPS Location', `¬±${accuracy}m`);
                },
                (error) => {
                    let errorMsg;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = 'GPS access denied. Try network location instead.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = 'GPS unavailable. Trying network location...';
                            getNetworkLocation();
                            return;
                        case error.TIMEOUT:
                            errorMsg = 'GPS timeout. Trying network location...';
                            getNetworkLocation();
                            return;
                        default:
                            errorMsg = 'GPS error. Trying alternatives...';
                            break;
                    }
                    console.warn('GPS Error:', errorMsg);
                    alert(errorMsg);
                },
                options
            );
        }
        
        // Network Location Method (low accuracy GPS)
        function getNetworkLocation() {
            if (!navigator.geolocation) {
                alert('Network location not supported');
                return;
            }
            
            const options = {
                enableHighAccuracy: false, // Use network instead of GPS
                timeout: 8000,
                maximumAge: 60000
            };
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = Math.round(position.coords.accuracy);
                    
                    setLocation(lat, lng, 'Network Location', `¬±${accuracy}m`);
                },
                (error) => {
                    console.warn('Network location failed, trying IP location...');
                    getIPLocation();
                },
                options
            );
        }
        
        // IP Geolocation Method
        async function getIPLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                if (data.latitude && data.longitude) {
                    const lat = parseFloat(data.latitude);
                    const lng = parseFloat(data.longitude);
                    
                    setLocation(lat, lng, `IP Location (${data.city || 'Unknown'})`, '~1-10km');
                } else {
                    throw new Error('No location data in IP response');
                }
            } catch (error) {
                console.warn('IP location failed:', error);
                alert('All location methods failed. Please select manually on map or choose a test location.');
            }
        }
        
        // Enable manual selection mode
        function enableManualSelection() {
            alert('Click anywhere on the map to set your location');
        }
        
        // Use selected location (for integration with main app)
        function useSelectedLocation() {
            if (!selectedLocation) {
                alert('Please select a location first');
                return;
            }
            
            // This would integrate with your main navigation app
            const result = {
                lat: selectedLocation.lat,
                lng: selectedLocation.lng,
                source: selectedLocation.source,
                accuracy: selectedLocation.accuracy,
                timestamp: new Date().toISOString()
            };
            
            // Show result
            alert(`Location Selected!\n\nCoordinates: ${result.lat.toFixed(6)}, ${result.lng.toFixed(6)}\nSource: ${result.source}\nAccuracy: ${result.accuracy}`);
            
            // You can integrate this with your main app by:
            // 1. Posting to parent window
            // 2. Saving to localStorage
            // 3. Calling a callback function
            localStorage.setItem('selectedLocation', JSON.stringify(result));
            
            console.log('Selected Location:', result);
        }
        
        // Initialize when page loads
        window.onload = init;
    </script>
</body>
</html>